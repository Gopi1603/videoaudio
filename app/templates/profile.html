{% extends "base.html" %}
{% block title %}Profile — SecureMedia{% endblock %}

{% block content %}
<div class="row g-4">
  <!-- Account info -->
  <div class="col-lg-4">
    <div class="card p-4 text-center">
      <i class="bi bi-person-circle" style="font-size:4rem;color:var(--sm-primary)"></i>
      <h4 class="mt-3 fw-bold">{{ current_user.username }}</h4>
      <p class="text-muted mb-2">{{ current_user.email }}</p>
      <span class="badge {{ 'bg-danger' if current_user.is_admin else 'bg-secondary' }} mx-auto"
            style="font-size:.85rem">
        <i class="bi bi-shield-fill me-1"></i>{{ current_user.role|capitalize }}
      </span>
      <hr style="border-color:var(--sm-border)">
      <small class="text-muted">
        <i class="bi bi-calendar3 me-1"></i>Joined {{ current_user.created_at.strftime('%B %d, %Y') }}
      </small>
    </div>
  </div>

  <!-- Stats + activity -->
  <div class="col-lg-8">
    <div class="row g-3 mb-4">
      <div class="col-sm-6">
        <div class="stat-card">
          <div class="stat-label"><i class="bi bi-files me-1"></i>My Files</div>
          <div class="stat-value">{{ total_files }}</div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="stat-card">
          <div class="stat-label"><i class="bi bi-hdd me-1"></i>Storage Used</div>
          <div class="stat-value">{{ "%.1f"|format(total_size / 1048576) }} MB</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h6 class="mb-0"><i class="bi bi-clock-history me-2"></i>Recent Activity</h6>
      </div>
      <div class="card-body p-0">
        {% if recent_logs %}
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Action</th>
                <th>File</th>
                <th>Result</th>
                <th>Time</th>
              </tr>
            </thead>
            <tbody>
              {% for log in recent_logs %}
              <tr>
                <td>
                  {% if log.action == 'upload' %}<i class="bi bi-cloud-arrow-up text-primary me-1"></i>
                  {% elif log.action == 'download' %}<i class="bi bi-download text-success me-1"></i>
                  {% elif log.action == 'delete' %}<i class="bi bi-trash3 text-danger me-1"></i>
                  {% elif log.action == 'login' %}<i class="bi bi-box-arrow-in-right text-info me-1"></i>
                  {% elif log.action == 'logout' %}<i class="bi bi-box-arrow-right text-warning me-1"></i>
                  {% elif log.action == 'register' %}<i class="bi bi-person-plus text-success me-1"></i>
                  {% else %}<i class="bi bi-gear text-muted me-1"></i>{% endif %}
                  {{ log.action }}
                </td>
                <td>{% if log.media_id %}#{{ log.media_id }}{% else %}—{% endif %}</td>
                <td>
                  <span class="badge bg-{{ 'success' if log.result == 'success' else 'danger' }}">
                    {{ log.result }}
                  </span>
                </td>
                <td>
                  <span title="{{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S UTC') if log.timestamp else '' }}">
                    {{ log.timestamp.strftime('%b %d, %H:%M') if log.timestamp else 'N/A' }}
                  </span>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center py-4 text-muted">
          <i class="bi bi-clock-history" style="font-size:2rem"></i>
          <p class="mt-2 mb-0">No activity yet</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
